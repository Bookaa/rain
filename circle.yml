machine:
  python:
    version: 3.5.1
dependencies:
  pre:
    - sudo apt-get install llvm-3.8 clang-3.8 libgc-dev libunwind8-dev
    - sudo rm /usr/bin/llvm-config
    - sudo ln -s /usr/bin/llvm-config-3.8 /usr/bin/llvm-config
test:
  override:
    - export PYTHONPATH=$(pwd); export RAINLIB=$(pwd)/lib; export CLANG=$(which clang-3.8); tests/fix.sh; py.test -rap -v --tb=long --cov=rain --junit-xml=$CIRCLE_TEST_REPORTS/tests.xml
    - export PYTHONPATH=$(pwd); export CLANG=$(which clang-3.8); cd tests/lib && make init suite && LD_LIBRARY_PATH=./criterion/build ./suite --xml=$CIRCLE_TEST_REPORTS/tests_c.xml
